{% comment %}
Collection FAQ — polished UX (chevron, separators, animation, responsive type)
Only renders if at least one FAQ metafield has content
Client update: questions in purple, lighter font-weight
{% endcomment %}

{% liquid
  assign faq_count = 0
  for i in (1..10)
    assign q_key = 'question' | append: i
    assign a_key = 'answer' | append: i
    assign q = collection.metafields.custom[q_key]
    assign a = collection.metafields.custom[a_key]
    if q and a and q.value != blank and a.value != blank
      assign faq_count = faq_count | plus: 1
    endif
  endfor
%}

{% if faq_count > 0 %}
<section class="collection-faq spaced-section page-width color-{{ section.settings.color_scheme }}" aria-labelledby="collection-faq-heading">
  <style>
    #shopify-section-{{ section.id }} { margin-bottom: 4rem !important; }
    .collection-faq { padding-top: 2rem; padding-bottom: 2rem; }

    .faq-list { 
      margin-top: 1rem;
      border-top: 1px solid var(--color-border, rgba(0,0,0,.12));
    }
    .faq-row { border-bottom: 1px solid var(--color-border, rgba(0,0,0,.12)); }
    .faq-row summary { outline: none; }

    .accordion__title { 
      display: flex; align-items: center; justify-content: space-between;
      gap: 1rem; padding: 1rem 0; cursor: pointer; list-style: none;
    }
    .accordion__title::-webkit-details-marker { display: none; }

    .faq-question-heading {
      margin: 0;
      font-weight: 400; /* reduced from bold */
      line-height: 1.3;
      color: #5B2B7A; /* purple — replace with exact brand hex if different */
      font-size: clamp(1.125rem, 0.9rem + 0.8vw, 1.625rem);
    }

    .faq-chevron {
      width: 1.1rem; height: 1.1rem; flex: 0 0 auto;
      transition: transform .2s ease; color: currentColor;
    }
    .faq-row[open] .faq-chevron { transform: rotate(180deg); }

    .accordion__content {
      width: 100%; padding: 0 0 1.25rem 0;
      color: var(--color-foreground, currentColor);
      font-size: clamp(1rem, 0.95rem + 0.4vw, 1.5rem);
      line-height: 1.65; opacity: 0.95;
    }

    .faq-content-inner { overflow: hidden; max-height: 0; transition: max-height .25s ease; }
    .faq-row[open] .faq-content-inner { max-height: 1200px; }

    .accordion__title:hover .faq-question-heading { opacity: 0.85; }
    .faq-row[open] .faq-question-heading { opacity: 1; }
  </style>

  <h2 id="collection-faq-heading" class="title h2">{{ section.settings.heading | default: 'Frequently asked questions' }}</h2>

  <div class="accordion faq-list" role="list">
    {% capture faq_json %}[{% endcapture %}

    {% assign faq_index = 0 %}
    {% for i in (1..10) %}
      {% assign q_key = 'question' | append: i %}
      {% assign a_key = 'answer' | append: i %}
      {% assign q = collection.metafields.custom[q_key] %}
      {% assign a = collection.metafields.custom[a_key] %}

      {% if q and a and q.value != blank and a.value != blank %}
        {% assign faq_index = faq_index | plus: 1 %}

        <details class="accordion__item faq-row" role="listitem">
          <summary class="accordion__title" aria-controls="faq-a-{{ section.id }}-{{ i }}">
            <h3 class="h3 faq-question-heading"><span>{{ q | metafield_tag }}</span></h3>
            <svg class="faq-chevron" viewBox="0 0 20 20" aria-hidden="true" focusable="false">
              <path fill="currentColor" d="M5.8 7.3a1 1 0 0 1 1.4 0L10 10.1l2.8-2.8a1 1 0 1 1 1.4 1.4l-3.5 3.5a1 1 0 0 1-1.4 0L5.8 8.7a1 1 0 0 1 0-1.4Z"/>
            </svg>
          </summary>
          <div id="faq-a-{{ section.id }}-{{ i }}" class="accordion__content rte">
            <div class="faq-content-inner">
              {{ a | metafield_tag }}
            </div>
          </div>
        </details>

        {% capture faq_json %}
          {{ faq_json }}{% if faq_index > 1 %},{% endif %}{
            "@type": "Question",
            "name": {{ q.value | strip_html | strip | escape | json }},
            "acceptedAnswer": { "@type": "Answer", "text": {{ a.value | strip | json }} }
          }
        {% endcapture %}
      {% endif %}
    {% endfor %}
  </div>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": {{ faq_json }}]
  }
  </script>
</section>
{% endif %}

{% schema %}
{
  "name": "Collection FAQ",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Frequently asked questions" },
    { "type": "select", "id": "color_scheme", "label": "Color scheme", "default": "background-1",
      "options": [
        { "value": "background-1", "label": "Default" },
        { "value": "background-2", "label": "Alternate" },
        { "value": "accent-1", "label": "Accent 1" },
        { "value": "accent-2", "label": "Accent 2" }
      ]
    }
  ],
  "presets": [{ "name": "Collection FAQ" }]
}
{% endschema %}
